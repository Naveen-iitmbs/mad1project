{% extends "layout.html" %}
{% block content %}

<h2 class="mb-4">Admin Dashboard</h2>

{% with messages = get_flashed_messages() %}
  {% if messages %}
    {% for msg in messages %}
      <div class="alert alert-warning alert-dismissible fade show" role="alert">
        {{ msg }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  {% endif %}
{% endwith %}

<!-- Parking Lots Section -->
<div class="card mb-5">
  <div class="card-header bg-primary text-white">Create New Parking Lot</div>
  <div class="card-body">
    <form method="POST" action="/admin/create">
      <div class="row g-3">
        <div class="col-md-4">
          <input type="text" class="form-control" name="name" placeholder="Lot Name" required>
        </div>
        <div class="col-md-4">
          <input type="text" class="form-control" name="address" placeholder="Address" required>
        </div>
        <div class="col-md-2">
          <input type="text" class="form-control" name="pin" placeholder="PIN Code" required>
        </div>
        <div class="col-md-1">
          <input type="number" step="0.01" class="form-control" name="price" placeholder="Price" required>
        </div>
        <div class="col-md-1">
          <input type="number" class="form-control" name="max_spots" placeholder="Spots" required>
        </div>
      </div>
      <div class="mt-3">
        <button type="submit" class="btn btn-success">Create Lot</button>
      </div>
    </form>
  </div>
</div>

<!-- Existing Parking Lots -->
<h4>Existing Lots</h4>
<div class="table-responsive mb-5">
  <table class="table table-dark table-bordered table-hover">
    <thead>
      <tr>
        <th>Name</th>
        <th>Address</th>
        <th>PIN</th>
        <th>Price</th>
        <th>Total Spots</th>
        <th>Occupied</th>
        <th>Available</th>
        <th>Adjust Spots</th>
        <th>Delete</th>
      </tr>
    </thead>
    <tbody>
      {% for lot in lots %}
      <tr>
        <td>{{ lot.name }}</td>
        <td>{{ lot.address }}</td>
        <td>{{ lot.pin }}</td>
        <td>{{ lot.price }}</td>
        <td>{{ lot.total_spots }}</td>
        <td>{{ lot.occupied_spots }}</td>
        <td>{{ lot.available_spots }}</td>
        <td>
          <form action="/admin/update_spots/{{ lot.id }}" method="POST" class="d-flex">
            <input type="number" class="form-control form-control-sm me-1" name="new_spots" placeholder="New total" min="{{ lot.occupied_spots }}" required>
            <button type="submit" class="btn btn-sm btn-warning">Update</button>
          </form>
        </td>
        <td>
          <a href="/admin/delete/{{ lot.id }}" class="btn btn-sm btn-danger"
             onclick="return confirm('Are you sure you want to delete this lot?')">Delete</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Registered Users -->
<hr class="my-4">
<h4>Registered Users</h4>
<div class="table-responsive">
  <table class="table table-dark table-bordered table-striped">
    <thead>
      <tr>
        <th>ID</th>
        <th>Username</th>
      </tr>
    </thead>
    <tbody>
      {% for user in users %}
      <tr>
        <td>{{ user.id }}</td>
        <td>{{ user.username }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% endblock %}
